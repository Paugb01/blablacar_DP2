import time
from json import dumps
from confluent_kafka import Producer
import re

# Data points to be produced
location = [
    {'lon': -0.37767982482910156, 'lat': 39.46990895819994},
    {'lon': -0.37079811096191406, 'lat': 39.46675319157294},
    {'lon': -0.36390209197998047, 'lat': 39.46782397950909},
    {'lon': -0.35823822021484375, 'lat': 39.47104868526953},
    {'lon': -0.35434722900390625, 'lat': 39.47469008716329},
    {'lon': -0.3479957580566406, 'lat': 39.47431614314206},
    {'lon': -0.3437614440917969, 'lat': 39.47023227211741},
    {'lon': -0.3411865234375, 'lat': 39.46461214647102},
    {'lon': -0.3378105163574219, 'lat': 39.45855541610099},
    {'lon': -0.3328895568847656, 'lat': 39.45606173209037},
    {'lon': -0.32527923583984375, 'lat': 39.45531511819912},
    {'lon': -0.3192710876464844, 'lat': 39.45780890513396},
    {'lon': -0.3134346008300781, 'lat': 39.46104363536845},
    {'lon': -0.3088569641113281, 'lat': 39.46626045135869},
    {'lon': -0.37767982482910156, 'lat': 39.46990895819994},
    {'lon': -0.37079811096191406, 'lat': 39.46675319157294},
    {'lon': -0.36390209197998047, 'lat': 39.46782397950909},
    {'lon': -0.35823822021484375, 'lat': 39.47104868526953},
    {'lon': -0.35434722900390625, 'lat': 39.47469008716329},
    {'lon': -0.3479957580566406, 'lat': 39.47431614314206},
    {'lon': -0.3437614440917969, 'lat': 39.47023227211741},
    {'lon': -0.3411865234375, 'lat': 39.46461214647102},
    {'lon': -0.3378105163574219, 'lat': 39.45855541610099},
    {'lon': -0.3328895568847656, 'lat': 39.45606173209037},
    {'lon': -0.32527923583984375, 'lat': 39.45531511819912},
    {'lon': -0.3192710876464844, 'lat': 39.45780890513396},
    {'lon': -0.3134346008300781, 'lat': 39.46104363536845},
    {'lon': -0.3088569641113281, 'lat': 39.46626045135869},
    {'lon': -0.37767982482910156, 'lat': 39.46990895819994},
    {'lon': -0.37079811096191406, 'lat': 39.46675319157294},
    {'lon': -0.36390209197998047, 'lat': 39.46782397950909},
    {'lon': -0.35823822021484375, 'lat': 39.47104868526953},
    {'lon': -0.35434722900390625, 'lat': 39.47469008716329},
    {'lon': -0.3479957580566406, 'lat': 39.47431614314206},
    {'lon': -0.3437614440917969, 'lat': 39.47023227211741},
    {'lon': -0.3411865234375, 'lat': 39.46461214647102},
    {'lon': -0.3378105163574219, 'lat': 39.45855541610099},
    {'lon': -0.3328895568847656, 'lat': 39.45606173209037},
    {'lon': -0.32527923583984375, 'lat': 39.45531511819912},
    {'lon': -0.3192710876464844, 'lat': 39.45780890513396},
    {'lon': -0.3134346008300781, 'lat': 39.46104363536845},
    {'lon': -0.3088569641113281, 'lat': 39.46626045135869},
    {'lon': -0.37767982482910156, 'lat': 39.46990895819994},
    {'lon': -0.37079811096191406, 'lat': 39.46675319157294},
    {'lon': -0.36390209197998047, 'lat': 39.46782397950909},
    {'lon': -0.35823822021484375, 'lat': 39.47104868526953},
    {'lon': -0.35434722900390625, 'lat': 39.47469008716329},
    {'lon': -0.3479957580566406, 'lat': 39.47431614314206},
    {'lon': -0.3437614440917969, 'lat': 39.47023227211741},
    {'lon': -0.3411865234375, 'lat': 39.46461214647102},
    {'lon': -0.3378105163574219, 'lat': 39.45855541610099},
    {'lon': -0.3328895568847656, 'lat': 39.45606173209037},
    {'lon': -0.32527923583984375, 'lat': 39.45531511819912},
    {'lon': -0.3192710876464844, 'lat': 39.45780890513396},
    {'lon': -0.3134346008300781, 'lat': 39.46104363536845},
    {'lon': -0.3088569641113281, 'lat': 39.46626045135869}
] 

# Configuración del productor
config = {
    'bootstrap.servers': 'localhost:9092',  # Cambia esto con la dirección de tu servidor Kafka
    'client.id': 'python-producer'
}

# Crear un productor
producer = Producer(config)


topic_kafka = 'points'
 
count = 0

for point in location:
    data_bytes = dumps(point).encode('utf-8')  # Encode string to bytes
    key = str(count)
    producer.produce(topic=topic_kafka, value=data_bytes, key=key)  # Send bytes
    # After your loop where you send messages:
    producer.flush()
    time.sleep(5)
      

# Optionally, you can check if there are any messages that failed to be delivered:
if producer.flush() != 0:
    print("Some messages failed to be delivered")
    

